- name: Merge statuscake_uptime_tests with templates
  set_fact:
    statuscake_merged_uptime_tests: "{{ (statuscake_merged_uptime_tests | default([])) + [ item['template'] | default({}) | combine(item) ] }}"
  loop: "{{ statuscake_uptime_tests }}"
  loop_control:
    label: "{{ item['name'] }}"

- name: Configure uptime tests
  caktus.hosting_services.statuscake_uptime_test:
    api_key: "{{ statuscake_api_key }}"
    state: "{{ item['state'] }}"
    name: "{{ item['name'] }}"
    check_rate: "{{ item['check_rate']|default(statuscake_default_check_rate) }}"
    test_type: "{{ item['test_type']|default(statuscake_default_test_type) }}"
    website_url: "{{ item['website_url'] }}"
    basic_username: "{{ item['basic_username']|default(omit) }}"
    basic_password: "{{ item['basic_password']|default(omit) }}"
    tags: "{{ item['tags']|default(omit) }}"
    contact_groups: "{{ item['contact_groups']|default(omit) }}"
    final_endpoint: "{{ item['final_endpoint']|default(omit) }}"
    follow_redirects: "{{ item['follow_redirects']|default(omit) }}"
    log_file: "{{ item['log_file']|default(omit) }}"
    find_string: "{{ item['find_string']|default(omit) }}"
    confirmation: "{{ item['confirmation']|default(omit) }}"
    custom_header: "{{ item['custom_header']|default(omit) }}"
    do_not_find: "{{ item['do_not_find']|default(omit) }}"
    dns_ip: "{{ item['dns_ip']|default(omit) }}"
    dns_server: "{{ item['dns_server']|default(omit) }}"
    enable_ssl_alert: "{{ item['enable_ssl_alert']|default(omit) }}"
    host: "{{ item['host']|default(omit) }}"
    include_header: "{{ item['include_header']|default(omit) }}"
    paused: "{{ item['paused']|default(omit) }}"
    port: "{{ item['port']|default(omit) }}"
    post_body: "{{ item['post_body']|default(omit) }}"
    post_raw: "{{ item['post_raw']|default(omit) }}"
    regions: "{{ item['regions']|default(omit) }}"
    status_codes: "{{ item['status_codes']|default(omit) }}"
    timeout: "{{ item['timeout']|default(omit) }}"
    trigger_rate: "{{ item['trigger_rate']|default(omit) }}"
    use_jar: "{{ item['use_jar']|default(omit) }}"
    user_agent: "{{ item['user_agent']|default(omit) }}"
  loop: "{{ statuscake_merged_uptime_tests }}"
  loop_control:
    label: "{{ item['name'] }}"

- name: Clean up StatusCake variables
  set_fact:
    statuscake_merged_uptime_tests: []
